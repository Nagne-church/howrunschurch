<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>그리스도 중심의 교회 정치 원리</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard@1.3.9/dist/web/static/pretendard.min.css" />
    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #f0f2f5;
        }
        .infographic-card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            margin-bottom: 2rem;
            overflow: hidden;
            border-left-width: 8px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .infographic-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }
        .icon-bg {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .icon-bg svg {
            width: 32px;
            height: 32px;
        }
        .ask-question-btn {
            background-color: #4f46e5;
            color: white;
            font-weight: 600;
            padding: 10px 20px;
            border-radius: 8px;
            transition: background-color 0.3s ease;
            margin-top: 1.5rem;
            cursor: pointer;
        }
        .ask-question-btn:hover {
            background-color: #4338ca;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0s 0.3s;
        }
        .modal-container {
            background-color: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.3s ease;
        }
        .modal-overlay.active .modal-container {
            transform: scale(1);
        }
        .modal-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            flex-grow: 1;
        }
        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid #e5e7eb;
        }
        .chat-bubble {
            padding: 12px 16px;
            border-radius: 18px;
            margin-bottom: 12px;
            max-width: 85%;
            word-wrap: break-word;
        }
        .user-bubble {
            background-color: #eef2ff;
            color: #4338ca;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }
        .ai-bubble {
            background-color: #f3f4f6;
            color: #1f2937;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }
        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #9ca3af;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-10">
    <main class="max-w-4xl mx-auto">
        <header class="text-center mb-12">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-800 mb-3">그리스도 중심의 교회 정치 원리</h1>
            <p class="text-lg sm:text-xl text-gray-600">성경에 나타난 교회의 본질, 정치, 권세, 직분, 그리고 치리회에 대한 심층 해설</p>
        </header>

        <section id="chapter1" class="infographic-card" style="border-color: #3b82f6;">
            <div class="p-6 sm:p-8 flex items-start gap-6">
                <div class="icon-bg" style="background-color: #dbeafe;">
                    <svg style="color: #3b82f6;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 21h19.5m-18-18v18m10.5-18v18m6-13.5V21M6.75 6.75h.75m-.75 3h.75m-.75 3h.75m3-6h.75m-.75 3h.75m-.75 3h.75M9 21v-3.375c0-.621.504-1.125 1.125-1.125h3.75c.621 0 1.125.504 1.125 1.125V21" />
                    </svg>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">제 1장: 교회의 본질 (What Is the Church?)</h2>
                    <div class="space-y-4 text-gray-700 leading-relaxed">
                        <p>교회는 하나님의 구속 계획의 중심에 있으며, 그리스도인의 삶에 필수적인 역할을 합니다. 교회의 본질을 이해하는 것은 그 정부와 권세를 이해하는 첫걸음입니다.</p>
                        
                        <h3 class="text-lg font-semibold mt-6 mb-2">하나님의 단일한 백성</h3>
                        <p>성경은 구약의 이스라엘과 신약의 교회가 별개의 백성이 아니라, 구속사 전체를 아우르는 하나님의 <strong>단일한 백성</strong>임을 가르칩니다. 로마서 11장에서 바울은 하나님의 백성을 하나의 감람나무에 비유합니다. 믿음 없는 가지(유대인)는 꺾이고, 이방인 신자들이 그 자리에 접붙임 되지만, 나무 자체는 하나입니다. 이는 교회가 이스라엘을 대체한 것이 아니라, 하나님의 언약 백성이 확장된 것임을 보여줍니다.</p>

                        <h3 class="text-lg font-semibold mt-6 mb-2">보이는 교회와 보이지 않는 교회</h3>
                        <p>성경은 교회를 두 가지 관점에서 설명하는데, 이는 '보이는 교회'(Visible Church)와 '보이지 않는 교회'(Invisible Church)라는 신학적 구분으로 이해할 수 있습니다.</p>
                        <ul class="list-disc list-inside space-y-2 pl-2">
                            <li><strong>보이지 않는 교회:</strong> 오직 하나님만이 아시는 모든 시대의 택함 받은 자들의 총체입니다. 이는 그리스도의 신부이자 몸으로서, 그 수가 영원히 고정되어 있습니다.</li>
                            <li><strong>보이는 교회:</strong> 전 세계에서 참된 신앙을 고백하는 모든 사람들과 그들의 자녀들로 구성됩니다. 이곳은 우리가 실제로 보고 경험하는 교회 공동체이며, 참된 신자뿐 아니라 불신자도 섞여 있을 수 있습니다.</li>
                        </ul>
                        <p>이 구분은 신자가 아닌 사람이 교회 회원일 수 있는 이유와, 참된 신자가 은혜에서 결코 완전히 떨어질 수 없다는 교리를 이해하는 데 도움을 줍니다.</p>

                        <h3 class="text-lg font-semibold mt-6 mb-2">교회 회원의 자격과 필요성</h3>
                        <p>그리스도인은 반드시 보이는 교회의 회원이 되어야 합니다. 이는 성경의 여러 가르침에서 명백히 드러납니다. 지상 대위임령(마 28:18-20)은 회심자를 모아 가르치는 공동체를 전제하며, 사도행전은 회심한 자들이 즉시 신자들의 공동체에 '더해졌다'(행 2:47)고 기록합니다. 또한, 성도의 교제, 권징, 성찬, 그리고 장로들의 돌봄(히 13:17)과 같은 명령들은 모두 유형적인 교회 회원이라는 관계를 전제합니다.</p>
                        <p><strong>누가 회원인가?</strong> 보이는 교회의 회원은 <strong>신앙을 고백하는 자들과 그들의 자녀들</strong>입니다. 아브라함 언약(창 17장)에서 하나님은 아브라함뿐만 아니라 그의 후손에게도 하나님이 되겠다고 약속하셨습니다. 이 언약의 원리는 신약에서도 지속되어, 신자의 자녀들은 언약 공동체의 일원으로 인정받으며, 언약의 표(구약의 할례, 신약의 세례)를 받을 자격이 있습니다.</p>
                    </div>
                    <button class="ask-question-btn">이 장에 대해 질문하기</button>
                </div>
            </div>
        </section>

        <section id="chapter2" class="infographic-card" style="border-color: #8b5cf6;">
            <div class="p-6 sm:p-8 flex items-start gap-6">
                <div class="icon-bg" style="background-color: #ede9fe;">
                    <svg style="color: #8b5cf6;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h7.5" />
                    </svg>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">제 2장: 교회의 정치 (The Government of the Church)</h2>
                    <div class="space-y-4 text-gray-700 leading-relaxed">
                        <p>교회는 단순한 인간 조직이 아니라, 왕이신 그리스도께서 직접 다스리시는 신적인 기관입니다. 따라서 교회의 정치는 인간의 편의가 아닌, 성경에 계시된 하나님의 방식에 따라 이루어져야 합니다.</p>
                        
                        <h3 class="text-lg font-semibold mt-6 mb-2">그리스도의 중보적 통치</h3>
                        <p>예수 그리스도께서는 두 종류의 통치권을 가지십니다. 첫째는 성자 하나님으로서 가지시는 <strong>본질적 통치권</strong>이며, 둘째는 부활 승천 후 메시야로서 받으신 <strong>중보적 통치권</strong>(마 28:18)입니다. 교회를 다스리시는 것은 바로 이 중보적 통치권에 해당하며, 이는 교회를 위해 온 세상을 다스리는 권세를 포함합니다.</p>

                        <h3 class="text-lg font-semibold mt-6 mb-2">교회와 국가의 분리</h3>
                        <p>그리스도의 나라는 "이 세상에 속한 것이 아니므로"(요 18:36), 교회의 정부는 국가 정부와 명확히 구별됩니다. 예수님께서는 "가이사의 것은 가이사에게, 하나님의 것은 하나님께 바치라"(마 22:21)고 말씀하심으로써 두 영역의 독립성을 인정하셨습니다. 국가는 자연법에 따라 사회 질서를 유지하는 역할을 하며 강제력(칼)을 사용하지만, 교회는 오직 성경의 법에 따라 영적인 권세(열쇠)만을 사용합니다. 따라서 국가는 교회의 신앙적 문제에 개입할 수 없으며, 교회 역시 국가의 정치적 사안에 직접 관여하지 않습니다.</p>

                        <h3 class="text-lg font-semibold mt-6 mb-2">신적 기원의 원리 (Jure Divino)</h3>
                        <p>장로교 정치의 핵심은 교회의 정부 형태가 인간의 지혜나 편의(jure humano)가 아닌, <strong>하나님의 신적인 권리(jure divino)</strong>에 의해 성경에 제정되었다는 믿음입니다. 그리스도께서는 사도들을 통해 교회가 따라야 할 정치의 원칙, 규범, 그리고 본보기를 성경에 명확히 제시하셨습니다. 따라서 교회는 시대나 문화에 따라 임의로 정부 형태를 바꿀 수 없으며, 성경의 패턴에 충실해야 합니다.</p>
                        
                        <h3 class="text-lg font-semibold mt-6 mb-2">상황적 요소의 적용</h3>
                        <p>성경이 모든 세부사항을 규정하는 것은 아닙니다. 예배 시간이나 회의 정족수와 같이 본질적이지 않은 '상황적 요소'(circumstances)들은 "덕을 세우고"(고전 14:26), "적당하게 하고 질서 있게"(고전 14:40) 하라는 성경의 일반 원칙에 따라 교회가 지혜롭게 정할 수 있습니다.</p>
                    </div>
                    <button class="ask-question-btn">이 장에 대해 질문하기</button>
                </div>
            </div>
        </section>

        <section id="chapter3" class="infographic-card" style="border-color: #ec4899;">
            <div class="p-6 sm:p-8 flex items-start gap-6">
                <div class="icon-bg" style="background-color: #fce7f3;">
                    <svg style="color: #ec4899;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 5.25a3 3 0 013 3m3 0a6 6 0 01-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1121.75 8.25z" />
                    </svg>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">제 3장: 교회의 권세 (The Power of the Church)</h2>
                    <div class="space-y-4 text-gray-700 leading-relaxed">
                        <p>교회의 권세는 세상의 권세와 그 성격이 근본적으로 다릅니다. 이 권세는 섬김을 위한 것이며, 오직 그리스도로부터 나옵니다.</p>

                        <h3 class="text-lg font-semibold mt-6 mb-2">권세의 원천과 위임</h3>
                        <ul class="list-disc list-inside space-y-2 pl-2">
                            <li><strong>원천:</strong> 교회의 모든 권세는 오직 중보자이신 예수 그리스도로부터 나옵니다. 교회는 스스로 법을 만들거나 권위를 창출할 수 없습니다.</li>
                            <li><strong>위임:</strong> 그리스도께서는 이 권세를 교회 전체, 즉 다스리는 자와 다스림을 받는 자 모두에게 위임하셨습니다. 일반 성도들은 이 권세를 '직분자를 선택'하는 것을 통해 행사하며, 선택된 직분자들은 교회를 다스리는 것을 통해 권세를 행사합니다.</li>
                        </ul>

                        <h3 class="text-lg font-semibold mt-6 mb-2">권세의 성격: 목양적이며 선언적</h3>
                        <p>교회의 권세는 입법적이거나 강제적이지 않고, <strong>목양적(ministerial)이며 선언적(declarative)</strong>입니다. 즉, 교회는 새로운 법을 만드는 것이 아니라, 이미 성경에 기록된 그리스도의 법을 선포하고 적용할 뿐입니다. 교회의 모든 결정은 성경의 가르침에 부합할 때에만 권위를 가집니다. 이는 개인의 양심을 부당하게 속박하는 것을 막고, 오직 하나님만이 양심의 주인이심을 인정하는 중요한 원리입니다.</p>

                        <h3 class="text-lg font-semibold mt-6 mb-2">권세의 세 가지 영역</h3>
                        <p>교회의 사법권(power of jurisdiction)은 세 가지 영역으로 나타납니다.</p>
                        <ol class="list-decimal list-inside space-y-2 pl-2">
                            <li><strong>교리권 (Power of Doctrine):</strong> 신앙고백을 작성하고, 오류를 경계하며, 신앙 양심의 문제를 판단하는 권세입니다.</li>
                            <li><strong>질서권 (Power of Order):</strong> 예배, 정치, 권징의 구체적인 절차와 같은 '상황적 요소'들을 성경의 일반 원리에 따라 정하는 권세입니다.</li>
                            <li><strong>권징권 (Power of Discipline):</strong> 그리스도의 법에 순종하도록 요구하며, 회원을 받아들이고, 불순종하는 자를 성찬에서 제외하거나 출교하는 권세입니다. 권징의 목적은 징벌이 아니라 회복과 교회의 순결입니다.</li>
                        </ol>
                    </div>
                    <button class="ask-question-btn">이 장에 대해 질문하기</button>
                </div>
            </div>
        </section>

        <section id="chapter4" class="infographic-card" style="border-color: #10b981;">
            <div class="p-6 sm:p-8 flex items-start gap-6">
                <div class="icon-bg" style="background-color: #d1fae5;">
                    <svg style="color: #10b981;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-4.67c.12-.318.232-.656.328-1.014a.75.75 0 011.498.07z" />
                    </svg>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">제 4장: 교회의 직분 (The Offices of the Church)</h2>
                    <div class="space-y-4 text-gray-700 leading-relaxed">
                        <p>그리스도께서는 교회의 덕을 세우고 성도를 온전하게 하기 위해 직분자들을 선물로 주셨습니다(엡 4:11-12). 성경은 이 직분들을 명확히 구분합니다.</p>
                        
                        <h3 class="text-lg font-semibold mt-6 mb-2">특별 직분과 일반 직분</h3>
                        <ul class="list-disc list-inside space-y-2 pl-2">
                            <li><strong>특별 직분 (Extraordinary Office):</strong> 교회의 기초를 놓기 위해 한시적으로 존재했던 직분으로 <strong>사도</strong>와 <strong>선지자</strong>가 해당됩니다. 이들은 하나님의 새로운 계시를 전달하는 역할을 했으며, 신약성경이 완성된 후에는 더 이상 존재하지 않습니다.</li>
                            <li><strong>일반 직분 (Ordinary Office):</strong> 교회가 존속하는 동안 항상 존재하는 항존직으로 <strong>장로(Elder)</strong>와 <strong>집사(Deacon)</strong>가 있습니다.</li>
                        </ul>

                        <h3 class="text-lg font-semibold mt-6 mb-2">장로 (Elder)</h3>
                        <p>장로는 교회의 영적 감독과 다스림을 책임지는 직분입니다. 장로는 두 종류로 구분되지만, 이는 직분의 등급 차이가 아니라 기능의 차이입니다.</p>
                        <ul class="list-disc list-inside space-y-2 pl-2">
                            <li><strong>가르치는 장로 (Teaching Elder):</strong> 목사. 설교와 가르치는 사역에 전념하며, 이를 위해 재정적 지원을 받습니다. 성례를 집례할 권한을 가집니다.</li>
                            <li><strong>다스리는 장로 (Ruling Elder):</strong> 교회의 치리와 영적 돌봄에 목사와 함께 참여합니다. 모든 장로는 가르칠 능력이 있어야 하지만(딤전 3:2), 다스리는 장로는 주로 치리에 집중합니다.</li>
                        </ul>
                        <p>성경은 감독(Bishop/Overseer)이라는 용어를 장로와 동일한 직분을 가리키는 말로 사용합니다(행 20:17, 28). 따라서 장로 위에 별도의 감독 직분을 두는 것은 비성경적입니다.</p>
                        
                        <h3 class="text-lg font-semibold mt-6 mb-2">집사 (Deacon)</h3>
                        <p>집사는 다스리는 직분이 아닌, <strong>섬기는 직분</strong>입니다. 사도행전 6장에서 사도들이 말씀과 기도에 전념하기 위해 구제와 재정 관리를 담당할 일곱 사람을 세운 것에서 그 기원을 찾을 수 있습니다. 집사의 주된 임무는 교회의 자비를 실천하고, 재정을 관리하며, 가난하고 도움이 필요한 성도들을 돌보는 것입니다. 이는 교회의 물리적, 실제적 필요를 채우는 영적인 사역입니다.</p>

                        <h3 class="text-lg font-semibold mt-6 mb-2">직분과 여성</h3>
                        <p>성경은 장로 직분을 남성에게만 제한합니다. 디모데전서 2장 12절은 여성이 남성을 가르치거나 다스리는 것을 금하는데, 이는 창조 질서(아담이 먼저 지음 받음)와 타락의 역사(하와가 먼저 속음)에 근거한 항구적인 원리입니다. 집사 직분에 대해서는 신학적 견해가 나뉘지만, 디모데전서 3장의 자격 요건과 직분이 가진 권위의 성격을 고려할 때, 집사 직분 역시 남성에게만 해당된다고 보는 것이 성경의 전체적인 가르침과 일관됩니다. 이는 여성의 가치를 폄하하는 것이 아니라, 창조 질서에 따른 기능의 구별을 의미합니다.</p>
                    </div>
                    <button class="ask-question-btn">이 장에 대해 질문하기</button>
                </div>
            </div>
        </section>

        <section id="chapter5" class="infographic-card" style="border-color: #f97316;">
            <div class="p-6 sm:p-8 flex items-start gap-6">
                <div class="icon-bg" style="background-color: #ffedd5;">
                    <svg style="color: #f97316;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 21h16.5M4.5 3h15M5.25 3v18m13.5-18v18M9 6.75h6.375M9 12h6.375M9 17.25h6.375" />
                    </svg>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">제 5장: 교회의 치리회 (The Courts of the Church)</h2>
                    <div class="space-y-4 text-gray-700 leading-relaxed">
                        <p>장로교 정치는 개별 교회가 독립적으로 존재하는 것이 아니라, 더 넓은 연합체 안에서 함께 다스림을 받는 구조를 가집니다. 이는 교회의 가시적 통일성을 실현하는 성경적인 방식입니다.</p>
                        
                        <h3 class="text-lg font-semibold mt-6 mb-2">상회(上會) 제도의 성경적 근거</h3>
                        <p>사도행전은 예루살렘 교회가 수많은 성도로 구성되어 여러 가정 교회로 모였지만, 여전히 '하나의 교회'(행 8:1)로 불렸음을 보여줍니다. 이들은 사도들과 장로들로 구성된 단일한 치리 구조 아래 있었습니다. 더 나아가, <strong>예루살렘 공의회(행 15장)</strong>는 상회 제도의 결정적인 모델을 제시합니다. 안디옥 교회에서 발생한 교리적 문제를 해결하기 위해, 그들은 상회인 예루살렘의 사도들과 장로들에게 대표를 파견했습니다. 공의회는 신중한 토론을 거쳐 결정을 내렸고, 이 결정은 모든 교회에 권위를 가졌습니다. 이는 개별 교회의 문제를 더 넓은 범위의 치리회가 다룰 수 있고, 그 결정에 순종해야 함을 보여줍니다.</p>

                        <h3 class="text-lg font-semibold mt-6 mb-2">치리회의 종류와 관계</h3>
                        <p>장로교회는 일반적으로 세 단계의 치리회(Court)를 가집니다.</p>
                        <ol class="list-decimal list-inside space-y-2 pl-2">
                            <li><strong>당회 (Session):</strong> 개별 교회를 다스리는 치리회로, 그 교회의 목사(가르치는 장로)와 치리 장로들로 구성됩니다.</li>
                            <li><strong>노회 (Presbytery):</strong> 특정 지역 내의 모든 교회들을 감독하는 치리회로, 그 지역의 모든 목사들과 각 교회를 대표하는 치리 장로들(총대)로 구성됩니다.</li>
                            <li><strong>총회 (General Assembly):</strong> 교단 전체의 최고 치리회로, 각 노회에서 파송한 목사 및 장로 총대들로 구성됩니다.</li>
                        </ol>
                        <p>이들 치리회는 계급적인 관계가 아니라, <strong>동일한 권세를 공유</strong>하지만 관할 범위가 다른 관계입니다. 즉, 노회의 권세가 당회보다 본질적으로 우월한 것이 아니라, 더 넓은 영역의 일을 다룰 뿐입니다. 하회(당회)는 상회(노회, 총회)의 감독과 결정에 순종할 의무가 있으며, 이는 교회의 연합과 질서를 유지하는 핵심 원리입니다.</p>
                    </div>
                    <button class="ask-question-btn">이 장에 대해 질문하기</button>
                </div>
            </div>
        </section>
    </main>

    <div id="qa-modal" class="modal-overlay">
        <div class="modal-container">
            <header class="modal-header">
                <h2 id="modal-title" class="text-xl font-bold text-gray-800">질문하기</h2>
                <button id="close-modal-btn" class="text-gray-500 hover:text-gray-800 text-3xl font-light">&times;</button>
            </header>
            <main id="modal-body" class="modal-body">
                <div id="chat-window" class="flex flex-col h-full space-y-4">
                    </div>
            </main>
            <footer class="modal-footer">
                <form id="qa-form" class="flex items-center gap-2">
                    <input id="question-input" type="text" class="flex-grow p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="여기에 질문을 입력하세요..." autocomplete="off">
                    <button type="submit" class="bg-indigo-600 text-white p-2 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                        </svg>
                    </button>
                </form>
            </footer>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const modal = document.getElementById('qa-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const qaForm = document.getElementById('qa-form');
            const questionInput = document.getElementById('question-input');
            const chatWindow = document.getElementById('chat-window');
            const modalTitle = document.getElementById('modal-title');
            
            let currentChapterTitle = '';
            let currentChapterContext = '';

            document.querySelectorAll('.ask-question-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const card = e.target.closest('.infographic-card');
                    currentChapterTitle = card.querySelector('h2').innerText;
                    
                    const contentDiv = card.querySelector('div > div');
                    currentChapterContext = Array.from(contentDiv.children)
                        .map(el => el.innerText.trim())
                        .filter(text => text)
                        .join('\n\n');

                    modalTitle.textContent = `${currentChapterTitle}`;
                    chatWindow.innerHTML = `
                        <div class="chat-bubble ai-bubble">
                            안녕하세요! <strong>${currentChapterTitle}</strong>에 대해 무엇이든 물어보세요.
                        </div>
                    `;
                    openModal();
                });
            });

            function openModal() {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
                setTimeout(() => questionInput.focus(), 300);
            }

            function closeModal() {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }

            closeModalBtn.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            });

            qaForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const userQuestion = questionInput.value.trim();
                if (!userQuestion) return;

                appendMessage(userQuestion, 'user');
                questionInput.value = '';
                showTypingIndicator();

                const finalPrompt = `
                    당신은 [콘텐츠 주제]에 대해 설명하는 전문 AI 어시스턴트입니다. 아래에 명시된 두 가지 규칙의 우선순위를 반드시 지켜서 사용자의 질문에 답변해 주세요.

                    [규칙 1: 주어진 자료 우선의 원칙]
                    - 최우선적으로, 아래에 제공되는 "[강의 노트 내용]"에 근거하여 답변을 생성해야 합니다.
                    - 자료에 명시된 사실과 논리를 바탕으로 질문에 직접적으로 그리고 자연스럽게 답해주세요.

                    [규칙 2: 지식 확장 및 보충의 원칙]
                    - 만약 "[강의 노트 내용]"만으로 답변하기에 정보가 불충분하거나 관련 내용이 없을 경우에는, 당신의 전통적 개혁신학의 전문 지식을 활용하여 답변을 보충할 수 있습니다.(반드시 전통 개혁신학에 근거해야 합니다.)
                    - 이 경우, 보충된 내용이 원래 자료에 없었음을 명확히 하기 위해 "보충 설명을 드리자면..." 과 같이 서술을 시작해주세요.

                    ---
                    [강의 노트 제목]: ${currentChapterTitle}
                    ---
                    [강의 노트 내용]:
                    ${currentChapterContext}
                    ---
                    [사용자 질문]:
                    ${userQuestion}
                `;

                try {
                    const response = await fetch('/api/ask-gemini', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ prompt: finalPrompt })
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    
                    // Safe navigation to extract text
                    const aiResponse = data?.candidates?.[0]?.content?.parts?.[0]?.text;

                    if (aiResponse === undefined) {
                        throw new Error("Invalid response structure from API. Text part is missing.");
                    }
                    
                    removeTypingIndicator();
                    appendMessage(aiResponse, 'ai');

                } catch (error) {
                    console.error('Error fetching AI response:', error);
                    removeTypingIndicator();
                    appendMessage('죄송합니다. 답변을 가져오는 중 오류가 발생했습니다. 잠시 후 다시 시도해 주세요.', 'ai');
                }
            });

            function appendMessage(text, sender) {
                const messageDiv = document.createElement('div');
                const bubbleClass = sender === 'user' ? 'user-bubble' : 'ai-bubble';
                messageDiv.className = `chat-bubble ${bubbleClass} flex flex-col`;
                
                // Simple markdown to HTML conversion
                let htmlText = text
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;")
                    .replace(/'/g, "&#039;");
                
                htmlText = htmlText
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\n/g, '<br>');

                messageDiv.innerHTML = htmlText;
                chatWindow.appendChild(messageDiv);
                chatWindow.scrollTop = chatWindow.scrollHeight;
            }
            
            function showTypingIndicator() {
                const typingDiv = document.createElement('div');
                typingDiv.id = 'typing-indicator';
                typingDiv.className = 'chat-bubble ai-bubble typing-indicator';
                typingDiv.innerHTML = '<span></span><span></span><span></span>';
                chatWindow.appendChild(typingDiv);
                chatWindow.scrollTop = chatWindow.scrollHeight;
            }

            function removeTypingIndicator() {
                const indicator = document.getElementById('typing-indicator');
                if (indicator) {
                    indicator.remove();
                }
            }
        });
    </script>
</body>
</html>
