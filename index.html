
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>장로교회 정치원리: 대화형 학습</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
        html, body { height: 100%; overflow: hidden; }
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f3f4f6; }
        .accordion-header { cursor: pointer; transition: all 0.3s ease; }
        .accordion-header.active { background-color: #e0e7ff; border-left-color: #4f46e5; }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-in-out, padding-top 0.5s ease-in-out, padding-bottom 0.5s ease-in-out; padding: 0 1.5rem; }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #e2e8f0; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #a0aec0; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #718096; }
        #modal-overlay.hidden { display: none; }
        .chat-bubble-user { background-color: #4f46e5; color: white; }
        .chat-bubble-bot { background-color: #e5e7eb; color: #1f2937; }
        .summary-content h3 { font-size: 1.2rem; font-weight: 700; margin-top: 1.25rem; margin-bottom: 0.75rem; color: #312e81; padding-bottom: 4px; border-bottom: 1px solid #c7d2fe; }
        .summary-content p, .summary-content li { color: #374151; line-height: 1.8; margin-bottom: 1rem; }
        .summary-content ul { list-style-type: '✓ '; list-style-position: inside; padding-left: 0.5rem; }
        .summary-content blockquote { border-left: 4px solid #818cf8; padding: 1rem; margin: 1.5rem 0; font-style: italic; color: #4b5563; background-color: #f9fafb; border-radius: 0 8px 8px 0; }
    </style>
</head>
<body class="flex items-center justify-center p-4">
    <div class="w-full max-w-5xl h-[95vh] flex flex-col bg-white rounded-2xl shadow-2xl border border-gray-200">
        <header class="bg-gradient-to-r from-indigo-700 to-indigo-900 text-white p-5 rounded-t-2xl shadow-lg flex-shrink-0">
            <h1 class="text-3xl font-bold text-center">장로교회 정치원리: 대화형 학습</h1>
            <p class="text-md text-center text-indigo-200 mt-1">"예수님은 교회를 어떻게 다스리시는가" 상세 요약</p>
        </header>

        <main id="summary-panel" class="flex-1 p-6 md:p-8 overflow-y-auto custom-scrollbar">
            <div class="space-y-4">
                
                <div class="accordion-item border border-gray-200 rounded-lg overflow-hidden">
                    <div class="accordion-header flex justify-between items-center p-5 bg-gray-50 hover:bg-indigo-50 border-l-4 border-transparent">
                        <h2 class="text-xl font-bold text-gray-800 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-3 text-indigo-600"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25" /></svg>서론: 왜 교회 정치가 중요한가?</h2>
                        <span class="transform transition-transform duration-300 text-indigo-600 font-bold text-2xl">＋</span>
                    </div>
                    <div class="accordion-content">
                        <div class="p-6 border-t border-gray-200 summary-content">
                            <p>교회 정치는 단순히 행정 절차나 규칙의 문제가 아니라, 그리스도인의 제자도에 있어 핵심적인 부분입니다. 올바른 교회 정치는 교회의 머리이신 예수 그리스도의 지혜와 영광을 드러내기 때문입니다. 성경은 그리스도와 교회의 관계가 분리될 수 없음을 강조하며(엡 5:23), 교회는 그리스도의 통치가 가시적으로 나타나는 '그리스도의 왕국'(WCF 25.2)입니다. 또한, 교회는 지상대위임령(마 28:18-20)을 수행하는 유일한 기관이며, 이 사명을 감당하기 위해서는 성경적인 질서와 통치가 반드시 필요합니다. 따라서 교회 정치를 아는 것은 그리스도를 더 깊이 알고 그분의 몸 된 교회를 더 잘 섬기는 길입니다.</p>
                            <button class="ask-question-btn mt-4 bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-indigo-700 transition">이해를 돕는 질문하기</button>
                        </div>
                    </div>
                </div>

                <div class="accordion-item border border-gray-200 rounded-lg overflow-hidden">
                    <div class="accordion-header flex justify-between items-center p-5 bg-gray-50 hover:bg-indigo-50 border-l-4 border-transparent">
                        <h2 class="text-xl font-bold text-gray-800 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-3 text-indigo-600"><path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9.004 9.004 0 0 0 8.716-6.747M12 21a9.004 9.004 0 0 1-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 0 1 7.843 4.582M12 3a8.997 8.997 0 0 0-7.843 4.582m15.686 0A11.953 11.953 0 0 1 12 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0 1 21 12c0 .778-.099 1.533-.284 2.253m0 0A11.953 11.953 0 0 1 12 13.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0 0 3 12c0 .778.099 1.533.284 2.253m0 0" /></svg>제1장: 교회란 무엇인가?</h2>
                        <span class="transform transition-transform duration-300 text-indigo-600 font-bold text-2xl">＋</span>
                    </div>
                    <div class="accordion-content">
                        <div class="p-6 border-t border-gray-200 summary-content">
                            <h3>⛪ 하나님의 한 백성: 구약과 신약의 연속성</h3>
                            <p>교회는 신약 시대에 갑자기 등장한 조직이 아니라, 구약의 이스라엘로부터 이어지는 하나님의 단일한 백성입니다. 하나님은 아브라함과 맺으신 언약을 폐기하신 것이 아니라, 그리스도 안에서 그 언약을 성취하고 모든 민족에게로 확장하셨습니다. 로마서 11장의 '올리브 나무 비유'는 이를 명확히 보여줍니다. 믿지 않는 원래 가지(유대인)는 꺾이고, 그 자리에 야생 올리브 나무 가지인 이방인이 접붙여졌지만, 나무의 뿌리(아브라함 언약과 구속의 약속)는 동일합니다. 이는 교회가 구속사의 중심에 있는 하나님의 영원한 계획의 일부임을 증거합니다.</p>
                            <h3>👁️ 보이는 교회와 보이지 않는 교회</h3>
                            <p>성경은 교회를 두 가지 측면에서 설명합니다. '보이지 않는 교회'는 시간과 공간을 초월하여 오직 하나님만이 아시는 모든 시대의 택함 받은 성도들의 총합으로, 흠 없는 그리스도의 신부입니다. 반면 '보이는 교회'는 이 땅에서 참된 신앙을 공적으로 고백하는 자들과 그들의 자녀들로 구성된 제도적 교회입니다. 이 두 교회는 겹치지만 완전히 동일하지는 않습니다. 보이는 교회 안에는 알곡과 가라지가 섞여 있듯, 중생하지 않은 사람이 있을 수 있습니다. 이 구분은 교회 내에 위선과 배교가 존재할 수 있음을 설명하며, 우리가 사람의 마음을 판단할 수 없고 오직 '믿을 만한 신앙고백'을 근거로 회원을 받아야 함을 가르쳐줍니다.</p>
                            <h3>🤝 교회 회원권의 필연성과 자격</h3>
                            <p>그리스도인의 제자도에 있어 교회 회원권은 선택이 아닌 필수입니다. 신약의 수많은 "서로"라는 명령(서로 사랑하라, 서로 용납하라 등)은 구체적인 공동체 안에서의 언약적 관계를 전제합니다. 회원권은 교회의 다스림과 권징 아래 자신을 복종시키며, 성도의 교제를 통해 함께 성장하겠다는 공적인 약속입니다. 회원의 자격은 그리스도에 대한 신앙을 공적으로 고백하는 사람과, 언약의 연속성 안에서 그들의 자녀에게 주어집니다. 이것이 유아세례의 핵심적인 성경적 근거가 됩니다.</p>
                            <button class="ask-question-btn mt-4 bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-indigo-700 transition">이해를 돕는 질문하기</button>
                        </div>
                    </div>
                </div>

                <div class="accordion-item border border-gray-200 rounded-lg overflow-hidden">
                     <div class="accordion-header flex justify-between items-center p-5 bg-gray-50 hover:bg-indigo-50 border-l-4 border-transparent">
                        <h2 class="text-xl font-bold text-gray-800 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-3 text-indigo-600"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-.189m-1.5.189a6.01 6.01 0 0 1-1.5-.189m3.75 7.478a12.06 12.06 0 0 1-4.5 0m3.75 2.311a7.5 7.5 0 0 1-7.5 0c-1.255 0-2.443.29-3.5.832m14.5.002c1.057-.542 2.245-.832 3.5-.832a7.5 7.5 0 0 1-7.5 0m-4.5 0a12.06 12.06 0 0 0 4.5 0m-4.5 0a7.5 7.5 0 0 0-3.5.832m0 0c-1.057.542-2.245.832-3.5.832a7.5 7.5 0 0 0 7.5 0m-7.5 0a7.5 7.5 0 0 1 3.5.832M12 6.75a2.25 2.25 0 1 1 0 4.5 2.25 2.25 0 0 1 0-4.5zM12 6.75a2.25 2.25 0 0 0-2.25 2.25v.003c.004.001.006.001.009.001h4.482c.002-.001.005-.001.008-.001v-.003A2.25 2.25 0 0 0 12 6.75z" /></svg>제2장: 교회의 통치</h2>
                        <span class="transform transition-transform duration-300 text-indigo-600 font-bold text-2xl">＋</span>
                    </div>
                    <div class="accordion-content">
                        <div class="p-6 border-t border-gray-200 summary-content">
                             <h3>📜 신적 권위의 원리 (Jure Divino)</h3>
                             <p>교회의 정치 형태는 인간의 지혜나 시대적 상황에 따라 결정되는 '인적 권위(Jure Humano)'의 산물이 아닙니다. 교회는 그리스도께서 성경에 명확히 제시하신 원리, 규범, 모범에 따라 세워져야 하는 '신적 권위(Jure Divino)'를 따릅니다. 이는 교회의 주권이 인간이나 회중이 아닌 오직 그리스도께 있음을 의미하며, 교회의 모든 구조와 결정은 성경이라는 헌법에 근거해야 함을 뜻합니다.</p>
                             <h3>👑 그리스도의 통치: 본질적 통치와 중보적 통치</h3>
                             <p>그리스도의 통치는 두 가지로 이해됩니다. '본질적 통치'는 그분이 성자 하나님으로서 온 우주를 다스리시는 것을 의미합니다. '중보적 통치'는 부활 승천하심으로 얻으신 권세로, 자신의 피로 사신 교회를 특별하게 다스리시는 것을 말합니다. 교회는 바로 이 중보적 통치의 중심에 있습니다.</p>
                             <h3>🏛️ 교회와 국가의 분리</h3>
                             <p>교회와 국가는 하나님께서 각기 다른 목적과 권세를 부여하신 두 개의 구별된 기관입니다. 국가는 일반 은총의 영역에서 '칼'의 권세로 사회 질서를 유지하고, 교회는 특별 은총의 영역에서 '열쇠'의 권세(말씀 선포와 권징)로 영적 질서를 다룹니다. 예수께서 "내 나라는 이 세상에 속한 것이 아니니라"(요 18:36)라고 말씀하셨듯이, 교회는 국가의 정치적 수단을 사용해서는 안 되며, 국가 또한 교회의 신앙과 양심의 문제에 관여해서는 안 됩니다.</p>
                             <button class="ask-question-btn mt-4 bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-indigo-700 transition">이해를 돕는 질문하기</button>
                        </div>
                    </div>
                </div>
                
                <div class="accordion-item border border-gray-200 rounded-lg overflow-hidden">
                     <div class="accordion-header flex justify-between items-center p-5 bg-gray-50 hover:bg-indigo-50 border-l-4 border-transparent">
                        <h2 class="text-xl font-bold text-gray-800 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-3 text-indigo-600"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 5.25a3 3 0 0 1 3 3m3 0a6 6 0 0 1-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1 1 21.75 8.25Z" /></svg>제3장: 교회의 권세</h2>
                        <span class="transform transition-transform duration-300 text-indigo-600 font-bold text-2xl">＋</span>
                    </div>
                    <div class="accordion-content">
                        <div class="p-6 border-t border-gray-200 summary-content">
                             <h3>🔑 권세의 원천과 본질</h3>
                             <p>교회의 모든 권세는 오직 중보자이신 예수 그리스도로부터 나옵니다. 따라서 교회의 권세는 새로운 법을 만드는 '입법적(Legislative)' 권세가 아니라, 이미 주어진 그리스도의 법(성경)을 선포하고 적용하는 '사역적(Ministerial)이며 선언적(Declarative)'인 권세입니다. 이는 교회가 성경을 넘어서 성도들의 양심을 억압할 수 없음을 의미하며, 교회의 모든 결정은 성경의 권위 아래 있어야 합니다.</p>
                             <h3>🤲 권세의 위임과 행사</h3>
                             <p>그리스도의 권세는 교회 전체(다스리는 자와 다스림을 받는 자 모두)에 주어졌습니다. 이 권세는 두 가지 방식으로 행사됩니다. 회중은 직분자를 선택함으로써 권세를 행사하고, 선택받은 직분자들은 교회를 다스리고 섬김으로써 권세를 행사합니다. 직분자의 권세는 '질서의 권세'(설교, 성례 등 개별적 행사)와 '치리의 권세'(권징, 규칙 제정 등 회의체를 통한 공동 행사)로 나뉩니다.</p>
                             <h3>🎯 치리권의 세 가지 범위</h3>
                             <p>치리회(당회, 노회, 총회)는 세 가지 영역에서 권세를 행사합니다: 1) **교리(Doctrine):** 신앙고백서 채택, 이단 규정 등. 2) **질서(Order):** 예배와 정치의 구체적인 절차 제정. 3) **권징(Discipline):** 죄에 대한 징계와 회복.</p>
                             <button class="ask-question-btn mt-4 bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-indigo-700 transition">이해를 돕는 질문하기</button>
                        </div>
                    </div>
                </div>

                <div class="accordion-item border border-gray-200 rounded-lg overflow-hidden">
                     <div class="accordion-header flex justify-between items-center p-5 bg-gray-50 hover:bg-indigo-50 border-l-4 border-transparent">
                        <h2 class="text-xl font-bold text-gray-800 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-3 text-indigo-600"><path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m-7.5-2.962a3.75 3.75 0 0 1 5.25 0m4.5 0a3.75 3.75 0 0 1 5.25 0M4.5 19.5a3 3 0 0 1-3-3V8.25a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v8.25a3 3 0 0 1-3 3h-9Zm1.5-9a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1-.75-.75Zm.75 2.25a.75.75 0 0 0 0 1.5h3a.75.75 0 0 0 0-1.5h-3Z" /></svg>제4장: 교회의 직분</h2>
                        <span class="transform transition-transform duration-300 text-indigo-600 font-bold text-2xl">＋</span>
                    </div>
                    <div class="accordion-content">
                        <div class="p-6 border-t border-gray-200 summary-content">
                             <h3>📜 직분의 기원과 종류</h3>
                             <p>모든 직분은 지위나 권력이 아니라, 승천하신 그리스도께서 자신의 교회를 세우고 성도를 온전하게 하기 위해 주신 선물입니다(엡 4:11). 직분은 크게 두 종류로 나뉩니다. 교회의 기초를 놓기 위한 한시적인 '특별 직분'(사도, 선지자)은 신약 성경이 완성됨에 따라 종료되었습니다. 그리고 교회가 항상 필요로 하는 영구적인 '일반 직분'(장로, 집사)이 있습니다.</p>
                             <h3>👨‍💼 일반 직분: 장로와 집사</h3>
                             <p><strong>장로(Elder)</strong>는 '감독', '목자'로도 불리며, 교회를 다스리고(치리) 영적으로 감독하는 직분입니다. 장로 직분 안에는 두 가지 구별된 역할이 있습니다. '가르치는 장로'(목사)는 말씀 선포와 성례 집례에 전념하고, '다스리는 장로'(치리 장로)는 목사와 동등한 권위로 교회의 치리와 목양에 동참합니다. 성경은 창조 질서에 근거하여 이 직분을 남성에게만 허락합니다(딤전 2:11-14).</p>
                             <p><strong>집사(Deacon)</strong>는 긍휼과 봉사의 직분입니다. 초대교회에서 사도들이 말씀과 기도에 전념하기 위해 구제와 재정 관리를 맡길 사람을 세운 것에서 유래합니다(행 6:1-6). 집사는 교회의 재정을 관리하고 연약한 자들을 돌봄으로써 교회의 사랑과 연합을 실질적으로 표현합니다.</p>
                             <button class="ask-question-btn mt-4 bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-indigo-700 transition">이해를 돕는 질문하기</button>
                        </div>
                    </div>
                </div>

                <div class="accordion-item border border-gray-200 rounded-lg overflow-hidden">
                     <div class="accordion-header flex justify-between items-center p-5 bg-gray-50 hover:bg-indigo-50 border-l-4 border-transparent">
                        <h2 class="text-xl font-bold text-gray-800 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-3 text-indigo-600"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3v11.25A2.25 2.25 0 0 0 6 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0 1 18 16.5h-2.25m-7.5 0h7.5m-7.5 0-1 3m8.5-3 1 3m0 0 .5 1.5m-.5-1.5h-9.5m0 0-.5 1.5M9 11.25v1.5M12 9v3.75m3-6v6" /></svg>제5장: 교회의 회의 (치리회)</h2>
                        <span class="transform transition-transform duration-300 text-indigo-600 font-bold text-2xl">＋</span>
                    </div>
                    <div class="accordion-content">
                        <div class="p-6 border-t border-gray-200 summary-content">
                             <h3>⚖️ 단계별 회의체와 그 필요성</h3>
                             <p>교회는 개별 지역 교회의 집합을 넘어 그리스도 안에서 하나인 유기적인 몸입니다. 이 가시적 연합을 표현하고 유지하기 위해 개별 교회를 넘어서는 상위 회의체(치리회)가 필요합니다. 사도행전 15장의 예루살렘 공회는 여러 지역 교회 대표들이 모여 교리적 문제를 해결하고 권위 있는 결정을 내린 성경적 모범입니다. 장로교 정치는 이를 따라 단계별 회의를 통해 운영됩니다.</p>
                             <ul class="list-disc list-inside text-gray-700 mb-4">
                                 <li><strong>당회 (Session):</strong> 한 개별 교회의 영적, 행정적 문제를 다스리는 기초 회의입니다.</li>
                                 <li><strong>노회 (Presbytery):</strong> 특정 지역 내 여러 교회들의 연합과 공동 사역을 관장하는 상급 회의입니다.</li>
                                 <li><strong>총회 (General Assembly):</strong> 한 교단의 전체 교회를 대표하는 최고 회의입니다.</li>
                             </ul>
                             <h3>🤝 회의체의 관계</h3>
                             <p>모든 회의체는 본질적으로 동일한 종류의 권세를 가지며, 관할 범위만 다릅니다. 하급 회의는 상급 회의의 감독과 통제를 받음으로써 교회의 연합과 질서가 유지됩니다. 상급 회의의 합법적인 결정은 단순한 조언이 아니라 하급 회의와 소속 교인들에게 권위를 가지며 순종해야 할 의무를 지닙니다.</p>
                             <button class="ask-question-btn mt-4 bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-indigo-700 transition">이해를 돕는 질문하기</button>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- Modal for Interactive Q&A -->
    <div id="modal-overlay" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-2xl shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <header class="p-4 border-b border-gray-200 flex justify-between items-center flex-shrink-0">
                <h2 id="modal-title" class="text-xl font-bold text-gray-800">질문하기</h2>
                <button id="close-modal-btn" class="text-2xl font-bold text-gray-500 hover:text-gray-800">&times;</button>
            </header>
            <div id="modal-chat-container" class="p-6 flex-1 overflow-y-auto custom-scrollbar">
                <!-- Chat messages will be appended here -->
            </div>
            <footer class="p-4 bg-gray-50 border-t border-gray-200">
                <div class="flex items-center">
                    <input type="text" id="modal-user-input" class="flex-1 border border-gray-300 rounded-full py-2 px-4 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="질문을 입력하세요...">
                    <button id="modal-send-btn" class="ml-3 bg-indigo-600 text-white rounded-full p-3 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:bg-indigo-300">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" /></svg>
                    </button>
                </div>
            </footer>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const accordionItems = document.querySelectorAll('.accordion-item');
            const modalOverlay = document.getElementById('modal-overlay');
            const modalTitle = document.getElementById('modal-title');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const modalChatContainer = document.getElementById('modal-chat-container');
            const modalUserInput = document.getElementById('modal-user-input');
            const modalSendBtn = document.getElementById('modal-send-btn');

            let currentTopicContent = '';
            let currentTopicTitle = '';

            accordionItems.forEach(item => {
                const header = item.querySelector('.accordion-header');
                const content = item.querySelector('.accordion-content');
                const icon = header.querySelector('span');
                const askBtn = content.querySelector('.ask-question-btn');

                header.addEventListener('click', () => {
                    const isActive = header.classList.contains('active');

                    accordionItems.forEach(otherItem => {
                        otherItem.querySelector('.accordion-header').classList.remove('active');
                        const otherContent = otherItem.querySelector('.accordion-content');
                        otherContent.style.maxHeight = null;
                        otherContent.style.paddingTop = '0';
                        otherContent.style.paddingBottom = '0';
                        const otherIcon = otherItem.querySelector('.accordion-header span');
                        if (otherIcon) {
                           otherIcon.style.transform = 'rotate(0deg)';
                           otherIcon.textContent = '＋';
                        }
                    });

                    if (!isActive) {
                        header.classList.add('active');
                        content.style.paddingTop = '1.5rem';
                        content.style.paddingBottom = '1.5rem';
                        content.style.maxHeight = content.scrollHeight + "px";
                        if (icon) {
                            icon.style.transform = 'rotate(45deg)';
                            icon.textContent = '×';
                        }
                    }
                });
                
                if (askBtn) {
                     askBtn.addEventListener('click', (e) => {
                        e.stopPropagation(); 
                        
                        currentTopicTitle = header.querySelector('h2').textContent.trim();
                        const summaryElement = content.querySelector('.summary-content');
                        currentTopicContent = summaryElement ? summaryElement.innerText.replace('이해를 돕는 질문하기', '').trim() : '';
                        
                        modalTitle.textContent = `"${currentTopicTitle}" 질문하기`;
                        modalChatContainer.innerHTML = `<div class="flex justify-start mb-4"><div class="chat-bubble-bot p-3 rounded-lg max-w-lg"><p class="text-sm">안녕하세요! 선택하신 주제에 대해 궁금한 점을 질문해주세요.</p></div></div>`;
                        modalOverlay.classList.remove('hidden');
                        modalUserInput.focus();
                    });
                }
            });
            
            const addChatMessage = (text, sender) => {
                const bubble = document.createElement('div');
                bubble.className = `p-3 rounded-lg max-w-lg mb-2 ${sender === 'user' ? 'chat-bubble-user self-end' : 'chat-bubble-bot self-start'}`;
                bubble.innerHTML = `<p class="text-sm">${text}</p>`;

                const messageWrapper = document.createElement('div');
                messageWrapper.className = `flex mb-4 ${sender === 'user' ? 'justify-end' : 'justify-start'}`;
                messageWrapper.appendChild(bubble);

                modalChatContainer.appendChild(messageWrapper);
                modalChatContainer.scrollTop = modalChatContainer.scrollHeight;
            };

            const showTypingIndicator = () => {
                const typingIndicator = document.createElement('div');
                typingIndicator.id = 'typing-indicator';
                typingIndicator.className = 'flex justify-start mb-4';
                typingIndicator.innerHTML = `<div class="chat-bubble-bot p-3 rounded-lg"><div class="flex items-center space-x-1"><span class="h-2 w-2 bg-gray-400 rounded-full animate-bounce [animation-delay:-0.3s]"></span><span class="h-2 w-2 bg-gray-400 rounded-full animate-bounce [animation-delay:-0.15s]"></span><span class="h-2 w-2 bg-gray-400 rounded-full animate-bounce"></span></div></div>`;
                modalChatContainer.appendChild(typingIndicator);
                modalChatContainer.scrollTop = modalChatContainer.scrollHeight;
            };

            const removeTypingIndicator = () => {
                document.getElementById('typing-indicator')?.remove();
            };

            const callGeminiAPI = async (prompt) => {
                const apiUrl = '/api/ask-gemini'; 
                const payload = { prompt: prompt };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || `서버 요청 실패 (상태 코드: ${response.status})`);
                    }

                    const result = await response.json();
                    if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts[0]) {
                        return result.candidates[0].content.parts[0].text;
                    } else {
                        if (result.candidates && result.candidates[0].finishReason === 'SAFETY') {
                            return "콘텐츠 생성 정책에 따라 답변을 생성할 수 없습니다.";
                        }
                        throw new Error("API 응답 구조가 올바르지 않습니다.");
                    }
                } catch (error) {
                    console.error("API 호출 중 에러 발생:", error);
                    return `API 호출 중 오류가 발생했습니다. 이 기능을 사용하려면 서버(Netlify/Vercel)에 프로젝트가 정상적으로 배포되고 환경 변수(API 키)가 설정되어야 합니다.`;
                }
            };

            const handleModalSend = async () => {
                const question = modalUserInput.value.trim();
                if (!question) return;

                addChatMessage(question, 'user');
                modalUserInput.value = '';
                modalSendBtn.disabled = true;
                showTypingIndicator();

                try {
                    const prompt = \`당신은 개혁신학(Reformed Theology)에 정통한 신학자이자 '장로교회 정치원리' 전문가입니다. 사용자의 질문에 대해, 먼저 아래에 주어진 책의 요약 내용에 충실하게 답변해야 합니다. 그리고 개혁신학의 관점에서 내용을 보충하거나 신학적 의미를 더 깊이 설명하여 답변을 풍성하게 만들어 주세요. 예를 들어, 언약 신학, 하나님의 주권, 은혜의 방편 등의 개념을 활용할 수 있습니다. 답변은 항상 한국어로, 전문적이면서도 이해하기 쉬운 어조로 작성해주세요. 만약 주어진 요약 내용과 관련 없는 질문이라면, "선택하신 주제와 관련된 질문을 해주시면, 개혁신학의 관점에서 더 깊이 있는 답변을 드리겠습니다."라고 안내해주세요.\n\n### 주제: \${currentTopicTitle}\n\n### 요약 내용:\n\${currentTopicContent}\n\n### 사용자 질문: "\${question}"\`;
                    const botResponse = await callGeminiAPI(prompt);
                    removeTypingIndicator();
                    addChatMessage(botResponse.replace(/\n/g, '<br>'), 'bot');
                } catch (error) {
                    removeTypingIndicator();
                    console.error('Error:', error);
                    addChatMessage("오류가 발생했습니다. 잠시 후 다시 시도해주세요.", 'bot');
                } finally {
                    modalSendBtn.disabled = false;
                    modalUserInput.focus();
                }
            };

            modalSendBtn.addEventListener('click', handleModalSend);
            modalUserInput.addEventListener('keydown', (event) => {
                if (event.key === 'Enter' && !event.shiftKey) {
                    event.preventDefault();
                    handleModalSend();
                }
            });

            closeModalBtn.addEventListener('click', () => modalOverlay.classList.add('hidden'));
            modalOverlay.addEventListener('click', (e) => {
                if (e.target === modalOverlay) {
                    modalOverlay.classList.add('hidden');
                }
            });
        });
    </script>
</body>
</html>

