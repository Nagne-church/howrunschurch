<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>장로교회 정치원리: 대화형 학습</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
        html, body { height: 100%; overflow: hidden; }
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f3f4f6; }
        .accordion-header { cursor: pointer; transition: all 0.3s ease; }
        .accordion-header.active { background-color: #e0e7ff; border-left-color: #4f46e5; }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-in-out, padding-top 0.5s ease-in-out, padding-bottom 0.5s ease-in-out; padding: 0 1.5rem; }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #e2e8f0; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #a0aec0; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #718096; }
        #modal-overlay.hidden { display: none; }
        .chat-bubble-user { background-color: #4f46e5; color: white; }
        .chat-bubble-bot { background-color: #e5e7eb; color: #1f2937; }
        .summary-content h3 { font-size: 1.2rem; font-weight: 700; margin-top: 1.25rem; margin-bottom: 0.75rem; color: #312e81; padding-bottom: 4px; border-bottom: 1px solid #c7d2fe; }
        .summary-content p, .summary-content li { color: #374151; line-height: 1.8; margin-bottom: 1rem; }
        .summary-content ul { list-style-type: '✓ '; list-style-position: inside; padding-left: 0.5rem; }
        .summary-content blockquote { border-left: 4px solid #818cf8; padding: 1rem; margin: 1.5rem 0; font-style: italic; color: #4b5563; background-color: #f9fafb; border-radius: 0 8px 8px 0; }
    </style>
</head>
<body class="flex items-center justify-center p-4">
    <div class="w-full max-w-5xl h-[95vh] flex flex-col bg-white rounded-2xl shadow-2xl border border-gray-200">
        <header class="bg-gradient-to-r from-indigo-700 to-indigo-900 text-white p-5 rounded-t-2xl shadow-lg flex-shrink-0">
            <h1 class="text-3xl font-bold text-center">장로교회 정치원리: 대화형 학습</h1>
            <p class="text-md text-center text-indigo-200 mt-1">"예수님은 교회를 어떻게 다스리시는가" 상세 요약</p>
        </header>

        <main id="summary-panel" class="flex-1 p-6 md:p-8 overflow-y-auto custom-scrollbar">
            <div class="space-y-4">
                <!-- 아코디언 메뉴들 -->
                <div class="accordion-item border border-gray-200 rounded-lg overflow-hidden">
                    <div class="accordion-header flex justify-between items-center p-5 bg-gray-50 hover:bg-indigo-50 border-l-4 border-transparent">
                        <h2 class="text-xl font-bold text-gray-800 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-3 text-indigo-600"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25" /></svg>서론: 왜 교회 정치가 중요한가?</h2>
                        <span class="transform transition-transform duration-300 text-indigo-600 font-bold text-2xl">＋</span>
                    </div>
                    <div class="accordion-content">
                        <div class="p-6 border-t border-gray-200 summary-content">
                            <p>교회 정치는 단순히 행정 절차나 규칙의 문제가 아니라, 그리스도인의 제자도에 있어 핵심적인 부분입니다. 올바른 교회 정치는 교회의 머리이신 예수 그리스도의 지혜와 영광을 드러내기 때문입니다. 성경은 그리스도와 교회의 관계가 분리될 수 없음을 강조하며(엡 5:23), 교회는 그리스도의 통치가 가시적으로 나타나는 '그리스도의 왕국'(WCF 25.2)입니다. 또한, 교회는 지상대위임령(마 28:18-20)을 수행하는 유일한 기관이며, 이 사명을 감당하기 위해서는 성경적인 질서와 통치가 반드시 필요합니다. 따라서 교회 정치를 아는 것은 그리스도를 더 깊이 알고 그분의 몸 된 교회를 더 잘 섬기는 길입니다.</p>
                            <button class="ask-question-btn mt-4 bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-indigo-700 transition">이해를 돕는 질문하기</button>
                        </div>
                    </div>
                </div>
                <!-- 다른 장들도 동일한 구조로 여기에 위치합니다 -->
            </div>
        </main>
    </div>

    <!-- Modal for Interactive Q&A -->
    <div id="modal-overlay" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-2xl shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <header class="p-4 border-b border-gray-200 flex justify-between items-center flex-shrink-0">
                <h2 id="modal-title" class="text-xl font-bold text-gray-800">질문하기</h2>
                <button id="close-modal-btn" class="text-2xl font-bold text-gray-500 hover:text-gray-800">&times;</button>
            </header>
            <div id="modal-chat-container" class="p-6 flex-1 overflow-y-auto custom-scrollbar"></div>
            <footer class="p-4 bg-gray-50 border-t border-gray-200">
                <div class="flex items-center">
                    <input type="text" id="modal-user-input" class="flex-1 border border-gray-300 rounded-full py-2 px-4 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="질문을 입력하세요...">
                    <button id="modal-send-btn" class="ml-3 bg-indigo-600 text-white rounded-full p-3 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:bg-indigo-300">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" /></svg>
                    </button>
                </div>
            </footer>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ... (이전 버전과 동일한 아코디언 및 모달 UI 로직) ...
            
            const callGeminiAPI = async (prompt) => {
                // 이 함수는 이제 Google API가 아닌 우리 서버의 함수를 호출합니다.
                // API 키는 이 코드에 더 이상 존재하지 않습니다.
                const apiUrl = '/api/ask-gemini'; 
                const payload = { prompt: prompt };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || `서버 요청 실패 (상태 코드: ${response.status})`);
                    }

                    const result = await response.json();
                    if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts[0]) {
                        return result.candidates[0].content.parts[0].text;
                    } else {
                        if (result.candidates && result.candidates[0].finishReason === 'SAFETY') {
                            return "콘텐츠 생성 정책에 따라 답변을 생성할 수 없습니다.";
                        }
                        throw new Error("API 응답 구조가 올바르지 않습니다.");
                    }
                } catch (error) {
                    console.error("API 호출 중 에러 발생:", error);
                    return `API 호출 중 오류가 발생했습니다. 이 기능을 사용하려면 서버(Netlify/Vercel)에 프로젝트가 정상적으로 배포되고 환경 변수(API 키)가 설정되어야 합니다.`;
                }
            };
            
            // ... (이전 버전과 동일한 handleModalSend 등 나머지 JS 로직) ...
        });
    </script>
</body>
</html>